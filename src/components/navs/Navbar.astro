---
import MobileNav from '@/components/navs/MobileNav.astro';
import ThemeSwitcher from '@/components/shared/ThemeSwitcher.astro';
import { siteConfig } from '@/config';
import { Image } from 'astro:assets';

const pathname = Astro.url.pathname;
const isHomePage = pathname === '/';

const navLinks = [
  { name: 'Home', href: '/' },
  { name: 'About', href: isHomePage ? '#about' : '/#about' },
  { name: 'Work', href: isHomePage ? '#work' : '/#work' },
  { name: 'Projects', href: isHomePage ? '#projects' : '/projects' },
  { name: 'Advisory', href: '/advisory' },
  { name: 'Contact', href: '/contact' },
];

const moreLinks = [
  { name: 'Resources', href: '/resources' },
  { name: 'Operating Notes', href: '/operating-notes' },
  { name: 'Blog', href: isHomePage ? '#blogs' : '/blog' },
];

// Helper function to check if a link is active
const isActive = (href: string) => {
  if (href === '/' && pathname === '/') return true;
  if (href.startsWith('#') && pathname === '/') return false;
  if (href.startsWith('/') && !href.includes('#')) {
    return pathname.startsWith(href) && href !== '/';
  }
  return false;
};
---

<header class='sticky top-0 z-50 py-6'>
  <nav class='flex items-center justify-between container-fluid'>
    <div class='font-bold'>
      <a
        href='/'
        data-astro-history='auto | push | replace'
        class='text-foreground flex items-center justify-center hover:text-primary transition-colors'
      >
        <Image
          src={siteConfig.profileImage}
          alt={siteConfig.name}
          width={56}
          height={56}
          format='avif'
        
          sizes='56px'
        
          class='size-14 border inline-block rounded-full object-cover'
        />
      </a>
    </div>

    <div
      class='hidden md:flex items-center backdrop-blur-2xl px-6 py-2 rounded-full gap-6 bg-secondary/20'
    >
      <ul class='flex space-x-6 items-center'>
        {
          navLinks.map((link) => (
            <li>
              <a
                href={link.href}
                data-astro-history='auto | push | replace'
                class={`text-foreground hover:text-primary transition-colors text-sm ${isActive(link.href) ? 'text-primary font-semibold border-b-2 border-primary' : ''}`}
              >
                {link.name}
              </a>
            </li>
          ))
        }
        <li class='relative group'>
          <button
            class='text-foreground hover:text-primary transition-colors text-sm flex items-center gap-1'
            aria-label='More menu'
          >
            Writing
            <svg
              xmlns='http://www.w3.org/2000/svg'
              class='size-3.5'
              fill='none'
              viewBox='0 0 24 24'
              stroke='currentColor'
            >
              <path
                stroke-linecap='round'
                stroke-linejoin='round'
                stroke-width='2'
                d='M19 9l-7 7-7-7'></path>
            </svg>
          </button>
          <ul
            class='absolute top-full right-0 mt-2 p-1.5 w-48 bg-background border border-border rounded shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200'
          >
            {
              moreLinks.map((link) => (
                <li
                  class={` px-4 py-2 text-foreground hover:text-primary hover:bg-secondary/50 transition-colors text-sm first:rounded-t-md last:rounded-b-md ${isActive(link.href) ? 'text-primary font-semibold bg-secondary/20' : ''}`}
                >
                  <a class='w-full block' href={link.href}>
                    {link.name}
                  </a>
                </li>
              ))
            }
          </ul>
        </li>
      </ul>
      <div class='flex items-center gap-2 border-l border-border pl-4'>
        <!-- <LanguageSwitcher /> -->
        <ThemeSwitcher />
      </div>
    </div>

    <MobileNav navLinks={[...navLinks, ...moreLinks]} />
  </nav>
</header>
