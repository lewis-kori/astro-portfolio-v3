---
import XIcon from './ui/icons/XIcon.astro';
import FacebookIcon from './ui/icons/FacebookIcon.astro';
import LinkedInIcon from './ui/icons/LinkedInIcon.astro';
import RedditIcon from './ui/icons/RedditIcon.astro';
import WhatsAppIcon from './ui/icons/WhatsAppIcon.astro';
import TelegramIcon from './ui/icons/TelegramIcon.astro';
import HackerNewsIcon from './ui/icons/HackerNewsIcon.astro';
import PinterestIcon from './ui/icons/PinterestIcon.astro';
import EmailIcon from './ui/icons/EmailIcon.astro';
import CopyIcon from './ui/icons/CopyIcon.astro';
import CheckIcon from './ui/icons/CheckIcon.astro';

interface Props {
  url: string;
  title: string;
  description?: string;
}

const { url, title, description = '' } = Astro.props;

const encodedUrl = encodeURIComponent(url);
const encodedTitle = encodeURIComponent(title);
const encodedDescription = encodeURIComponent(description);

const shareLinks = {
  twitter: `https://twitter.com/intent/tweet?url=${encodedUrl}&text=${encodedTitle}`,
  facebook: `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`,
  linkedin: `https://www.linkedin.com/sharing/share-offsite/?url=${encodedUrl}`,
  reddit: `https://reddit.com/submit?url=${encodedUrl}&title=${encodedTitle}`,
  hackernews: `https://news.ycombinator.com/submitlink?u=${encodedUrl}&t=${encodedTitle}`,
  whatsapp: `https://wa.me/?text=${encodedTitle}%20${encodedUrl}`,
  telegram: `https://t.me/share/url?url=${encodedUrl}&text=${encodedTitle}`,
  pinterest: `https://pinterest.com/pin/create/button/?url=${encodedUrl}&description=${encodedTitle}`,
  email: `mailto:?subject=${encodedTitle}&body=${encodedDescription}%0A%0A${encodedUrl}`,
};
---

<div class='social-share'>
  <div class='mb-4'>
    <h3 class='text-lg font-semibold'>Share this article</h3>
  </div>
  <div class='flex flex-wrap gap-3'>
    <!-- Twitter/X -->
    <a
      href={shareLinks.twitter}
      target='_blank'
      rel='noopener noreferrer'
      class='share-btn'
      aria-label='Share on X (Twitter)'
      title='Share on X'
    >
      <XIcon class='w-5 h-5' />
    </a>

    <!-- Facebook -->
    <a
      href={shareLinks.facebook}
      target='_blank'
      rel='noopener noreferrer'
      class='share-btn'
      aria-label='Share on Facebook'
      title='Share on Facebook'
    >
      <FacebookIcon class='w-5 h-5' />
    </a>

    <!-- LinkedIn -->
    <a
      href={shareLinks.linkedin}
      target='_blank'
      rel='noopener noreferrer'
      class='share-btn'
      aria-label='Share on LinkedIn'
      title='Share on LinkedIn'
    >
      <LinkedInIcon class='w-5 h-5' />
    </a>

    <!-- Reddit -->
    <a
      href={shareLinks.reddit}
      target='_blank'
      rel='noopener noreferrer'
      class='share-btn'
      aria-label='Share on Reddit'
      title='Share on Reddit'
    >
      <RedditIcon class='w-5 h-5' />
    </a>

    <!-- WhatsApp -->
    <a
      href={shareLinks.whatsapp}
      target='_blank'
      rel='noopener noreferrer'
      class='share-btn'
      aria-label='Share on WhatsApp'
      title='Share on WhatsApp'
    >
      <WhatsAppIcon class='w-5 h-5' />
    </a>

    <!-- Telegram -->
    <a
      href={shareLinks.telegram}
      target='_blank'
      rel='noopener noreferrer'
      class='share-btn'
      aria-label='Share on Telegram'
      title='Share on Telegram'
    >
      <TelegramIcon class='w-5 h-5' />
    </a>

    <!-- Hacker News -->
    <a
      href={shareLinks.hackernews}
      target='_blank'
      rel='noopener noreferrer'
      class='share-btn'
      aria-label='Share on Hacker News'
      title='Share on Hacker News'
    >
      <HackerNewsIcon class='w-5 h-5' />
    </a>

    <!-- Pinterest -->
    <a
      href={shareLinks.pinterest}
      target='_blank'
      rel='noopener noreferrer'
      class='share-btn'
      aria-label='Share on Pinterest'
      title='Share on Pinterest'
    >
      <PinterestIcon class='w-5 h-5' />
    </a>

    <!-- Email -->
    <a
      href={shareLinks.email}
      class='share-btn'
      aria-label='Share via Email'
      title='Share via Email'
    >
      <EmailIcon class='w-5 h-5' />
    </a>

    <!-- Copy Link -->
    <button
      type='button'
      class='share-btn copy-link-btn'
      data-url={url}
      aria-label='Copy link'
      title='Copy link'
    >
      <CopyIcon class='copy-icon w-5 h-5' />
      <CheckIcon class='check-icon hidden w-5 h-5' />
    </button>
  </div>
</div>

<style>
  .share-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    border-radius: 0.5rem;
    border: 1px solid hsl(var(--border));
    background: hsl(var(--card));
    color: hsl(var(--foreground));
    transition: all 0.2s ease;
    cursor: pointer;
  }

  .share-btn:hover {
    border-color: hsl(var(--primary));
    background: hsl(var(--primary) / 0.1);
    color: hsl(var(--primary));
    transform: translateY(-2px);
  }

  .copy-link-btn {
    position: relative;
  }

  .copy-link-btn .check-icon {
    color: hsl(var(--primary));
  }
</style>

<script>
  function initSocialShare() {
    const copyButtons = document.querySelectorAll('.copy-link-btn');

    copyButtons.forEach((button) => {
      button.addEventListener('click', async () => {
        const url = button.getAttribute('data-url');
        if (!url) return;

        try {
          await navigator.clipboard.writeText(url);

          const copyIcon = button.querySelector('.copy-icon');
          const checkIcon = button.querySelector('.check-icon');

          if (copyIcon && checkIcon) {
            copyIcon.classList.add('hidden');
            checkIcon.classList.remove('hidden');

            setTimeout(() => {
              copyIcon.classList.remove('hidden');
              checkIcon.classList.add('hidden');
            }, 2000);
          }
        } catch (err) {
          console.error('Failed to copy:', err);
        }
      });
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSocialShare);
  } else {
    initSocialShare();
  }

  document.addEventListener('astro:page-load', initSocialShare);
</script>
